asyncapi: 2.3.0
info:
  title: Recurring Payments API
  version: '0.1.0'
  description: | 
    Recurring Payments API.
    Accepts payment mandates commands and produces mandate lifecycle related messages
servers:
  local:
    url: amqp://localhost:5672
    protocol: amqp
    description: Local playground RabbitMQ server
    security:
      - user-password: []
channels:
  mandates/created:  
    bindings:
      $ref : '#/components/bindings/amqp'   
    subscribe:
      summary: Receive a mandate created event
      operationId: mandateCreated
      message:
        $ref : '#/components/messages/MandateCreated'    
    
components:
  securitySchemes:
    user-password:
      type: userPassword
  bindings:
    amqp:
      is: routingKey
      exchange:
        name: mandates
        type: topic
        durable: true
        autoDelete: false
        vhost: recurring-payments
  messages:
    MandateCreated:
      name: mandateCreated
      title: Mandate created event
      summary: Inform about a new mandate in the system
      contentType: application/json
      payload:
        $ref: '#/components/schemas/mandateCreatedPayload'
  schemas:
    mandateCreatedPayload:
      type: object
      properties:
        id:
          type: string
          description: "the id of the mandate"
        status:
          type: string
          description: "Status description"
        createdAt:
          type: string
          format: date-time      